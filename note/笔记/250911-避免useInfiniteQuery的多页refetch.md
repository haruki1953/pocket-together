å½“ç„¶ï¼ŒHarukiã€‚ä»¥ä¸‹æ˜¯æ ¹æ®æˆ‘ä»¬æ·±å…¥è®¨è®ºå¹¶ç»“åˆå®˜æ–¹è¡Œä¸ºç¡®è®¤åï¼Œé‡æ–°æ•´ç†çš„ä¸€ç¯‡æŠ€æœ¯ç¬”è®°ï¼Œä¸“æ³¨äº Vue Query v5 ä¸­ `useInfiniteQuery` çš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ï¼Œç‰¹åˆ«æ˜¯å¦‚ä½•é€šè¿‡ `staleTime: 'static'` å’Œ `removeQueries()` ç²¾å‡†æ§åˆ¶è¯·æ±‚è¡Œä¸ºï¼Œé¿å…å¤šé¡µ refetchã€‚

---

## ğŸ“˜ Vue Query v5 æŠ€æœ¯ç¬”è®°ï¼šå¦‚ä½•é¿å… `useInfiniteQuery` çš„å¤šé¡µ refetch

åœ¨ä½¿ç”¨ `useInfiniteQuery` æ—¶ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯ï¼šè°ƒç”¨ `refetch()` æˆ– `invalidateQueries()` ä¼šé‡æ–°è¯·æ±‚æ‰€æœ‰å·²åŠ è½½çš„åˆ†é¡µæ•°æ®ã€‚è¿™åœ¨å¼±ç½‘ç¯å¢ƒã€ç§»åŠ¨ç«¯æˆ–é¡µé¢çŠ¶æ€æ¢å¤åœºæ™¯ä¸‹å¯èƒ½é€ æˆæ€§èƒ½æµªè´¹å’Œç”¨æˆ·ä½“éªŒä¸‹é™ã€‚

### ğŸ¯ ç›®æ ‡

> **åªåœ¨éœ€è¦æ—¶æ‰‹åŠ¨é‡æ–°è¯·æ±‚ç¬¬ä¸€é¡µï¼Œå¹¶é¿å… refetch å¯¼è‡´å¤šé¡µè¯·æ±‚ã€‚**

---

### ğŸ§  æ ¸å¿ƒé…ç½®ç­–ç•¥

```ts
useInfiniteQuery({
  queryKey: ['yourKey'],
  queryFn: fetchFn,
  getNextPageParam: ...,
  staleTime: 'static',
  gcTime: Infinity,
})
```

#### ğŸ” è¡Œä¸ºè¯´æ˜ï¼š

- `staleTime: 'static'`
    
    - æŸ¥è¯¢æ°¸è¿œä¸ä¼šè¢«æ ‡è®°ä¸º stale
    - ç¦æ­¢æ‰€æœ‰è‡ªåŠ¨é‡æ–°è¯·æ±‚ï¼ˆèšç„¦ã€æŒ‚è½½ã€ç½‘ç»œæ¢å¤ç­‰ï¼‰
    - **å³ä½¿è°ƒç”¨ `invalidateQueries()` æˆ– `refetch()`ï¼Œä¹Ÿä¸ä¼šè§¦å‘è¯·æ±‚**
- `gcTime: Infinity`
    
    - ç¼“å­˜æ°¸ä¸è¢«åƒåœ¾å›æ”¶
    - æ•°æ®å§‹ç»ˆä¿ç•™ï¼Œç›´åˆ°ä½ æ‰‹åŠ¨æ¸…é™¤

---

### ğŸš« ä¸ºä»€ä¹ˆä¸èƒ½ç”¨ `refetch()`ï¼Ÿ

åœ¨ `useInfiniteQuery` ä¸­ï¼Œè°ƒç”¨ `refetch()` ä¼šé‡æ–°è¯·æ±‚æ‰€æœ‰å·²åŠ è½½çš„åˆ†é¡µæ•°æ®ï¼ˆ`pages`ï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´ï¼š

- å¤šæ¬¡å¹¶å‘è¯·æ±‚
- ä¸å¿…è¦çš„ç½‘ç»œè´Ÿæ‹…
- é¡µé¢çŠ¶æ€è¢«è¦†ç›–æˆ–é—ªçƒ

è€Œåœ¨ `staleTime: 'static'` çš„é…ç½®ä¸‹ï¼Œ`refetch()` æœ¬èº«ä¹Ÿè¢«ç¦ç”¨ï¼Œä¸ä¼šè§¦å‘ä»»ä½•è¯·æ±‚ã€‚

---

### âœ… æ¨èåšæ³•ï¼šæ‰‹åŠ¨é‡ç½®å¹¶åªè¯·æ±‚ç¬¬ä¸€é¡µ

```ts
queryClient.removeQueries({ queryKey: ['yourKey'] })
```

#### ğŸ” è¡Œä¸ºè¯´æ˜ï¼š

- æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®ï¼ˆåŒ…æ‹¬åˆ†é¡µæ•°æ®ã€çŠ¶æ€ã€é”™è¯¯ç­‰ï¼‰
- **ä¸ä¼šè‡ªåŠ¨é‡æ–°è¯·æ±‚**
- ä¸‹ä¸€æ¬¡ç»„ä»¶æŒ‚è½½æˆ–æ‰‹åŠ¨è°ƒç”¨ `refetch()` æ—¶ï¼Œåªè¯·æ±‚ç¬¬ä¸€é¡µ

ğŸ“Œ å®˜æ–¹è¡Œä¸ºç¡®è®¤ï¼š

> "`queryClient.removeQueries()` will remove the query from the cache, but it does **not notify active observers**, nor does it trigger a refetch. It simply deletes the query data."

---

### ğŸ§© å¯é€‰å°è£…ï¼š`resetInfiniteQuery()` å·¥å…·å‡½æ•°

```ts
function resetInfiniteQuery(queryKey: QueryKey) {
  queryClient.removeQueries({ queryKey })
}
```

> ç”¨äºåœ¨ç”¨æˆ·æ“ä½œæˆ–é¡µé¢åˆ‡æ¢æ—¶ï¼Œæ‰‹åŠ¨æ¸…ç©º infinite query å¹¶å‡†å¤‡é‡æ–°è¯·æ±‚ç¬¬ä¸€é¡µã€‚

---

### âœ… æ€»ç»“

|æ“ä½œæ–¹å¼|æ˜¯å¦é‡æ–°è¯·æ±‚|æ˜¯å¦æ¸…é™¤ç¼“å­˜|æ˜¯å¦é€‚åˆåªè¯·æ±‚ç¬¬ä¸€é¡µ|
|---|---|---|---|
|`refetch()`|âŒ å¦ï¼ˆstatic ç¦æ­¢ï¼‰|âŒ å¦|âŒ ä¼šè¯·æ±‚æ‰€æœ‰åˆ†é¡µæ•°æ®|
|`invalidateQueries()`|âŒ å¦ï¼ˆstatic ç¦æ­¢ï¼‰|âŒ å¦|âŒ åŒä¸Š|
|`removeQueries()`|âŒ å¦ï¼ˆéœ€æ‰‹åŠ¨è§¦å‘ï¼‰|âœ… æ˜¯|âœ… æœ€é€‚åˆ|

---

è¿™å¥—é…ç½®éå¸¸é€‚åˆä½ å½“å‰çš„ç›®æ ‡ï¼š**é¿å…å¤šé¡µè¯·æ±‚ã€ä¿æŒç¼“å­˜æŒä¹…ã€æ‰‹åŠ¨æ§åˆ¶æ›´æ–°æ—¶æœº**ã€‚å®ƒä¹Ÿä¸ºå›¢é˜Ÿæä¾›äº†ä¸€ä¸ªå¯å¤ç”¨çš„æŸ¥è¯¢é‡ç½®ç­–ç•¥ï¼Œå°¤å…¶é€‚ç”¨äºé¡µé¢çŠ¶æ€æ¢å¤ã€é™æ€åˆ†é¡µå†…å®¹æˆ–å¼±ç½‘ä¼˜åŒ–åœºæ™¯ã€‚

## ç›¸å…³æ–‡æ¡£é“¾æ¥
- https://tanstack.com.cn/query/latest/docs/framework/vue/guides/important-defaults
- https://tanstack.com.cn/query/latest/docs/framework/vue/reference/useQuery
- https://tanstack.com.cn/query/latest/docs/framework/vue/guides/caching