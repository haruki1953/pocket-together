
```
项目名 pocket-together
功能 群聊、同步观看
技术栈：
后端 pocketbase
前端 vue3 ts element-plus pinia tanstack/query
相关细节 前端使用pocketbase jsSDK并通过pocketbase-typegen来完善其类型

一期：
登陆注册 设置 房间 聊天 文件 在线状态
二期：
音视频播放 同步观看
三期：
electron桌面应用 文件下载 bt文件 bt下载
四期：
自动创建番剧房间，根据rss更新，提供番剧种子文件或磁链
五期：
移动端应用app，计划使用tauri
```

## 后端集合
pocketbase（简称pb）

### users集合 集合类型：Auth
```
储存用户信息，前端全员可获取、只可修改自己的信息（一些由pb限制的不会被修改，自己限制了level字段不能修改）
在pocketbase Dashboard中可以点击users集合页面上方的设置按钮，在选项页面可以配置OAuth2信息

重点字段
level 用户等级（basic · premium），只能由超级用户设置，默认值为basic，主要用于控制用户是否能上传文件（即能否在files集合创建）（需与config集合allow-basic-users-upload配置结合）
```

### config集合
```
储存关于本项目/站点公开的配置信息，前端全员可获取、不可修改

重点字段
key 配置键
value 配置值

重点配置
allow-basic-users-upload 是否允许basic基础用户上传图片，默认为true即可以
```

### files集合
```
储存用户上传的文件，前端全员可获取、据情况可上传、只可修改自己创建的

重点字段
file 文件
size 文件大小（需前端上传）
author users关系字段，创建者 
```

### messages 集合
```
储存聊天信息，前端全员可获取、登录后可创建

重点字段
author users关系字段，创建者 
room rooms关系字段，所属房间
quoteRoom rooms关系字段，用于发送房间链接
quoteFile file关系字段，用于发送文件
```

### rooms集合
```
储存房间，前端全员可获取、登录后可创建

重点字段
cover 封面图片
coverWidth 封面宽度
coverHeight 封面高度
author users关系字段，创建者
playlist files关系字段，播放列表

coverWidth、coverHeight 都是需要前端上传的，控制房间封面在首页的显示比例，对于交错式瀑布流的计算大概是必要的
```

### （未创建）在线状态事件集合
```
储存在线状态事件，前端全员可获取、登录后可创建

前端每隔一段时间就向这个集合创建一条记录，进入或退出房间时也要向这个集合创建记录。
而别的前端通过查询这个集合过去一段时间的记录，并订阅，就可以得知实时的用户在线情况
```

### （未创建）同步观看事件集合
```
储存同步观看事件，前端全员可获取、登录后可创建

细节还没想好，总之就是用来控制房间内同步观看
```


## 前端页面

### 首页（房间列表）
```
显示房间列表，用交错式瀑布流显示（类似电脑版小红书的布局？），根据屏幕宽度显示 5列左右到2列.
有一个菜单栏，在大屏时或许可以将其充当为瀑布流中的第一个卡片，小屏时就显示在顶部。菜单显示一些信息和选项，其中有 全部房间、搜索房间、查看收藏的房间 等选项，其还有跳转至创建房间页的功能。
```

### 房间页（聊天）
```
这个页面没有导航栏（即不是LayoutNav的子路由）。宽屏时为两栏，左栏是 房间封面、房间信息、此房间的在线人员、等，使用el滚动条，右栏是聊天栏，使用原生滚动条。窄屏时分为聊天页和详情页子路由。

聊天功能大概可以这样实现：
在前端初始化时，就开始订阅messages集合，并将其记录在store中
在进入房间时，请求获取messages集合，历史内容就靠请求获取。而实时发送的内容从store中获取
```

### 全局聊天
```
这个有导航栏，布局也和房间页有区别。宽屏时两栏，左栏是聊天（el滚动条），右栏显示所有用户及在线信息（原生滚动条）。窄屏时分为两个子路由，窄屏时因为底部有导航栏，会导致再加上聊天输入框后不好看，可以先不显示输入框，待用户按下某个按钮后，隐藏导航栏并显示输入框

messages集合中room字段为空的即为全局聊天
```

### 文件页
```
这个布局还没想好，反正就是显示被上传的文件列表，还有上传文件功能。重要的是复制（选中）功能，与其说是复制更类似选中，复制后会将文件id存在store，在聊天页会有“发送复制的文件”功能要用文件id。（聊天页也有简单的文件上传功能，可以之后再实现）
```

### 设置页
```
有二级导航栏，子路由为 个人信息页（已实现）、等。（还没想好有什么需要设置，以后再加吧）
```

### 导航页
```
上半部分显示头像与个人信息之类的、还有站点名称、明暗切换、语言切换、社交媒体图标链接。下半部分显示本项目常用页面的导航（因为如果有很多页面导航栏放不下，所以统一放在这里），作为卡片来显示：图标+页面名+描述。页面的最后一行是本项目 pocket-together 的github链接和版本号
项目名和站点名是不一样的，项目名是pocket-together，而站点名是可以自己配置的，以后计划实现再config集合配置站点名之类的信息
```

### 登录注册（已实现）
```
通过邮箱密码注册、登录，oauth2登录，忘记密码，游客模式（即跳转至主页）
```
