
## 设置页

### 个人信息页
开发顺序
```
修改昵称简介 表单样式 i18n 封装
修改逻辑
个人数据获取与填充 封装
是否登录判断，登录响应式，登录刷新
> 优化，路由信息统一管理
```

设置页开发顺序
```
v
表单样式
i18n
数据获取与填充
请求逻辑
其他
```

```
修改用户名
> 优化，表单校验规则统一管理
> 优化， queryRetryPbFetchTimeout 不止在超时时重试，在所有网络错误时也重试，重命名为 queryRetryPbNetworkError
修改头像 封装优化
```

#### 修改邮箱
决定使用pocketbase自带的修改界面（通过邮件进入），在自己的设置页只有邮件发送按钮就可以
```
组件显示
表单样式
遮罩确认
邮箱刷新
邮箱修改请求

速率限制（客户端）
pocketbase 配置 config 集合，前端使用
占位数据
```

遇到的问题
```
250731
发现了一些情况，原来修改邮箱和修改密码并不是类似的
修改密码不需要登录，调用接口时提供现在的邮箱，然后会向现在的邮箱发邮件，邮件中有重置密码验证链接，链接进入pocketbase自带的用户重置密码界面，输入新密码点击确认，即可修改密码
修改邮箱需要登录，调用接口时提供新邮箱，然后会向新邮箱发送邮件，邮件中有修改邮箱验证链接，链接进入pocketbase自带的修改邮箱验证接口，输入当前用户密码点击确认，以此修改邮箱

250801
修改邮件后，当前用户登录会失效，authRefresh会401，但问题是其并不会影响到pb.authStore，导致isValid仍是true
解决方法：需要的请求鉴权失败时清除authStore
```

#### 由pocketbase的config集合控制邮箱提交最短秒数
`src\config\pb-collection-config.ts`
```ts


// pocketbase 集合 config 其值的 zodSchema
export const pbCollectionConfigSchema = {
  'allow-basic-users-upload': z.boolean(),
  'email-update-rate-limit-second': z.number(),
}
// 类型体操：自动推导出类型结构
export type PbCollectionConfigType = {
  [K in keyof typeof pbCollectionConfigSchema]: z.infer<
    (typeof pbCollectionConfigSchema)[K]
  >
}

// pocketbase 集合 config 默认值
// export const pbCollectionConfigDefault: PbCollectionConfigType = { /* ... */ }
/**
 * pocketbase 集合 config 默认值获取函数
 * - 使用函数返回默认数据以避免忘记深拷贝
 */
export const pbCollectionConfigDefaultGetFn = () => {
  return {
    /*
      【pbCollectionConfigDefault_public START】
      此内容在前后端一致
      - vue3\src\config\pb-collection-config.ts
      - pocketbase\pb_hooks\initConfig.pb.js
    */

    /** 是否允许基础用户上传文件 */
    'allow-basic-users-upload': true,
    /** 邮箱提交最短秒数（由 客户端/前端 实现的速率限制，单位秒） */
    'email-update-rate-limit-second': 30,

    /*
      【pbCollectionConfigDefault_public END】
    */
  } as PbCollectionConfigType
}
```

`src\queries\pb-collection-config.ts`
```ts
/**
 * pocketbase 集合 config 的 useQuery
 *
 * 会将 config集合 的数组式数据转为对象，类型即为PbCollectionConfigType `src\config\pb-collection-config.ts`
 */
export const usePbCollectionConfigQuery = () => { /* ... */ }
```

#### 验证邮箱-修改密码
```
组件显示
表单样式
遮罩确认
邮箱刷新
邮箱请求
速率限制（客户端）
```
